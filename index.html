import React, { useState, useEffect } from 'react';
import { Plus, Save, Calculator, User, Package, DollarSign, Minus, PlusCircle, AlertCircle, BarChart3, Calendar, FileText, MessageCircle, Copy, Phone, Download, Trash2, Edit, CheckCircle } from 'lucide-react';

const MotoboyManagementSystem = () => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [motoboys, setMotoboys] = useState([]);
  const [rotas, setRotas] = useState([]);
  const [contadorMotoboy, setContadorMotoboy] = useState(1);
  const [contadorRota, setContadorRota] = useState(1);

  // Estados para formul√°rios
  const [novoMotoboy, setNovoMotoboy] = useState({
    nome: '',
    telefone: '',
    cnh: '',
    veiculo: '',
    placa: '',
    dataAdmissao: new Date().toISOString().split('T')[0]
  });

  const [novaRota, setNovaRota] = useState({
    motoboyId: '',
    data: new Date().toISOString().split('T')[0],
    quantidadePedidos: 0,
    valorRota: 0,
    dinheiroRecebido: 0,
    trocos: 0,
    descontos: 0,
    adiantamentos: 0,
    dinheiroRetido: 0,
    observacoes: ''
  });

  const [filtroData, setFiltroData] = useState(new Date().toISOString().split('T')[0]);

  // Inicializa√ß√£o com dados de exemplo
  useEffect(() => {
    carregarDadosExemplo();
  }, []);

  const carregarDadosExemplo = () => {
    const motoboyExample = [
      {
        id: 1,
        nome: 'Jo√£o Silva',
        telefone: '(11) 99999-1111',
        cnh: '12345678901',
        veiculo: 'Honda CG 160 Start',
        placa: 'ABC-1234',
        dataAdmissao: '2024-01-15',
        status: 'ativo',
        dataCadastro: new Date('2024-01-15')
      },
      {
        id: 2,
        nome: 'Carlos Santos',
        telefone: '(11) 99999-2222',
        cnh: '23456789012',
        veiculo: 'Yamaha Factor 125',
        placa: 'DEF-5678',
        dataAdmissao: '2024-02-01',
        status: 'ativo',
        dataCadastro: new Date('2024-02-01')
      },
      {
        id: 3,
        nome: 'Pedro Oliveira',
        telefone: '(11) 99999-3333',
        cnh: '34567890123',
        veiculo: 'Honda Bros 160',
        placa: 'GHI-9012',
        dataAdmissao: '2024-03-10',
        status: 'ativo',
        dataCadastro: new Date('2024-03-10')
      }
    ];

    const hoje = new Date().toISOString().split('T')[0];
    const ontem = new Date();
    ontem.setDate(ontem.getDate() - 1);
    const anteontem = new Date();
    anteontem.setDate(anteontem.getDate() - 2);

    const rotasExample = [
      {
        id: 1,
        motoboyId: 1,
        motoboyNome: 'Jo√£o Silva',
        data: hoje,
        quantidadePedidos: 12,
        valorRota: 240.00,
        dinheiroRecebido: 180.50,
        trocos: 15.00,
        descontos: 8.50,
        adiantamentos: 20.00,
        dinheiroRetido: 0.00,
        valorFinalReceber: 227.00,
        observacoes: 'Rota centro da cidade',
        prestouContas: false,
        dataCriacao: new Date()
      },
      {
        id: 2,
        motoboyId: 2,
        motoboyNome: 'Carlos Santos',
        data: hoje,
        quantidadePedidos: 8,
        valorRota: 160.00,
        dinheiroRecebido: 125.00,
        trocos: 10.00,
        descontos: 5.00,
        adiantamentos: 0.00,
        dinheiroRetido: 15.00,
        valorFinalReceber: 150.00,
        observacoes: 'Rota bairro norte',
        prestouContas: false,
        dataCriacao: new Date()
      },
      {
        id: 3,
        motoboyId: 1,
        motoboyNome: 'Jo√£o Silva',
        data: ontem.toISOString().split('T')[0],
        quantidadePedidos: 15,
        valorRota: 300.00,
        dinheiroRecebido: 220.00,
        trocos: 20.00,
        descontos: 12.00,
        adiantamentos: 30.00,
        dinheiroRetido: 0.00,
        valorFinalReceber: 278.00,
        observacoes: 'Dia de muito movimento',
        prestouContas: true,
        dataCriacao: ontem
      }
    ];

    setMotoboys(motoboyExample);
    setRotas(rotasExample);
    setContadorMotoboy(4);
    setContadorRota(4);
  };

  // Fun√ß√µes para Motoboys
  const cadastrarMotoboy = () => {
    if (!novoMotoboy.nome || !novoMotoboy.telefone) {
      alert('Por favor, preencha pelo menos o nome e telefone!');
      return;
    }

    const motoboy = {
      id: contadorMotoboy,
      ...novoMotoboy,
      status: 'ativo',
      dataCadastro: new Date()
    };

    setMotoboys([...motoboys, motoboy]);
    setContadorMotoboy(contadorMotoboy + 1);
    setNovoMotoboy({
      nome: '',
      telefone: '',
      cnh: '',
      veiculo: '',
      placa: '',
      dataAdmissao: new Date().toISOString().split('T')[0]
    });
    alert(`Motoboy ${novoMotoboy.nome} cadastrado com sucesso!`);
  };

  const removerMotoboy = (id) => {
    if (window.confirm('Tem certeza que deseja remover este motoboy?')) {
      setMotoboys(motoboys.filter(m => m.id !== id));
    }
  };

  // Fun√ß√µes para Rotas
  const calcularValorFinalReceber = (rota = novaRota) => {
    const { valorRota, trocos, descontos, adiantamentos, dinheiroRetido } = rota;
    // Valor da rota + trocos - descontos - adiantamentos + retido
    return valorRota + trocos - descontos - adiantamentos + dinheiroRetido;
  };

  const adicionarRota = () => {
    if (!novaRota.motoboyId || !novaRota.data || novaRota.quantidadePedidos === 0) {
      alert('Por favor, preencha os campos obrigat√≥rios: Motoboy, Data e Quantidade de Pedidos!');
      return;
    }

    const motoboy = motoboys.find(m => m.id === parseInt(novaRota.motoboyId));
    const valorFinalReceber = calcularValorFinalReceber();

    const rota = {
      id: contadorRota,
      ...novaRota,
      motoboyId: parseInt(novaRota.motoboyId),
      motoboyNome: motoboy.nome,
      valorFinalReceber,
      prestouContas: false,
      dataCriacao: new Date()
    };

    setRotas([...rotas, rota]);
    setContadorRota(contadorRota + 1);
    setNovaRota({
      motoboyId: '',
      data: new Date().toISOString().split('T')[0],
      quantidadePedidos: 0,
      valorRota: 0,
      dinheiroRecebido: 0,
      trocos: 0,
      descontos: 0,
      adiantamentos: 0,
      dinheiroRetido: 0,
      observacoes: ''
    });
    alert('Rota registrada com sucesso!');
  };

  const marcarPrestacao = (id) => {
    setRotas(rotas.map(r => r.id === id ? { ...r, prestouContas: true, dataPrestacao: new Date() } : r));
  };

  const removerRota = (id) => {
    if (window.confirm('Tem certeza que deseja remover esta rota?')) {
      setRotas(rotas.filter(r => r.id !== id));
    }
  };

  // Fun√ß√£o para formatar data
  const formatarData = (data) => {
    return new Date(data).toLocaleDateString('pt-BR');
  };

  // Fun√ß√£o para formatar moeda
  const formatarMoeda = (valor) => {
    return new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    }).format(valor);
  };

  // Fun√ß√£o para gerar texto do WhatsApp
  const gerarTextoWhatsApp = (motoboyId, data) => {
    const motoboy = motoboys.find(m => m.id === motoboyId);
    const rotasDoDia = rotas.filter(r => r.data === data && r.motoboyId === motoboyId);
    
    const totalPedidos = rotasDoDia.reduce((sum, r) => sum + r.quantidadePedidos, 0);
    const totalValorRota = rotasDoDia.reduce((sum, r) => sum + r.valorRota, 0);
    const totalRecebido = rotasDoDia.reduce((sum, r) => sum + r.dinheiroRecebido, 0);
    const totalTrocos = rotasDoDia.reduce((sum, r) => sum + r.trocos, 0);
    const totalDescontos = rotasDoDia.reduce((sum, r) => sum + r.descontos, 0);
    const totalAdiantamentos = rotasDoDia.reduce((sum, r) => sum + r.adiantamentos, 0);
    const totalRetido = rotasDoDia.reduce((sum, r) => sum + r.dinheiroRetido, 0);
    const totalValorFinal = rotasDoDia.reduce((sum, r) => sum + r.valorFinalReceber, 0);

    return `üèçÔ∏è *PRESTA√á√ÉO DE CONTAS DI√ÅRIA*
üìÖ Data: ${formatarData(data)}
üë§ Motoboy: *${motoboy.nome}*
üè™ Empresa: *Cal√ßados 24h*

üìä *RESUMO DO DIA:*
üõçÔ∏è Pedidos Entregues: ${totalPedidos}
üí∞ Valor da Rota: R$ ${totalValorRota.toFixed(2)}
üíµ Dinheiro Recebido: R$ ${totalRecebido.toFixed(2)}

üí∏ *C√ÅLCULO:*
‚ûï Trocos: R$ ${totalTrocos.toFixed(2)}
‚ûñ Descontos L√≠quido: R$ ${totalDescontos.toFixed(2)}
‚ûñ Adiantamento L√≠quido: R$ ${totalAdiantamentos.toFixed(2)}
‚ûï Retido: R$ ${totalRetido.toFixed(2)}

üí∞ *VALOR FINAL A RECEBER: R$ ${totalValorFinal.toFixed(2)}*

_Sistema de Gest√£o - ${new Date().toLocaleDateString('pt-BR')}_`;
  };

  // Fun√ß√£o para copiar card
  const copiarCard = (motoboyId, data) => {
    const texto = gerarTextoWhatsApp(motoboyId, data);
    navigator.clipboard.writeText(texto).then(() => {
      const motoboy = motoboys.find(m => m.id === motoboyId);
      alert(`Card de ${motoboy.nome} copiado para a √°rea de transfer√™ncia!`);
    });
  };

  // Fun√ß√£o para enviar WhatsApp
  const enviarWhatsApp = (telefone, motoboyId, data) => {
    const texto = gerarTextoWhatsApp(motoboyId, data);
    const numeroLimpo = telefone.replace(/\D/g, '');
    const url = `https://wa.me/55${numeroLimpo}?text=${encodeURIComponent(texto)}`;
    window.open(url, '_blank');
  };

  // Calcular estat√≠sticas do dashboard
  const hoje = new Date().toISOString().split('T')[0];
  const rotasHoje = rotas.filter(r => r.data === hoje);
  const totalMotoboysCadastrados = motoboys.length;
  const totalPedidosHoje = rotasHoje.reduce((sum, r) => sum + r.quantidadePedidos, 0);
  const totalRecebidoHoje = rotasHoje.reduce((sum, r) => sum + r.dinheiroRecebido, 0);
  const totalValorFinalHoje = rotasHoje.filter(r => !r.prestouContas).reduce((sum, r) => sum + r.valorFinalReceber, 0);

  // Renderizar cards do dashboard
  const renderDashboard = () => (
    <div className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div className="bg-white rounded-xl p-6 shadow-lg border-l-4 border-blue-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Motoboys Cadastrados</p>
              <p className="text-3xl font-bold text-blue-600">{totalMotoboysCadastrados}</p>
            </div>
            <User className="h-12 w-12 text-blue-500" />
          </div>
        </div>
        
        <div className="bg-white rounded-xl p-6 shadow-lg border-l-4 border-green-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Pedidos Hoje</p>
              <p className="text-3xl font-bold text-green-600">{totalPedidosHoje}</p>
            </div>
            <Package className="h-12 w-12 text-green-500" />
          </div>
        </div>
        
        <div className="bg-white rounded-xl p-6 shadow-lg border-l-4 border-yellow-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Recebido Hoje</p>
              <p className="text-3xl font-bold text-yellow-600">{formatarMoeda(totalRecebidoHoje)}</p>
            </div>
            <DollarSign className="h-12 w-12 text-yellow-500" />
          </div>
        </div>
        
        <div className="bg-white rounded-xl p-6 shadow-lg border-l-4 border-red-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Valor Final Hoje</p>
              <p className="text-3xl font-bold text-red-600">{formatarMoeda(totalValorFinalHoje)}</p>
            </div>
            <AlertCircle className="h-12 w-12 text-red-500" />
          </div>
        </div>
      </div>

      <div className="bg-white rounded-xl p-6 shadow-lg">
        <h3 className="text-xl font-bold text-gray-800 mb-4">üìä Resumo Geral do Sistema</h3>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="text-center p-4 bg-blue-50 rounded-lg">
            <div className="text-2xl font-bold text-blue-600">{rotas.length}</div>
            <div className="text-gray-600">Total de Rotas</div>
          </div>
          <div className="text-center p-4 bg-green-50 rounded-lg">
            <div className="text-2xl font-bold text-green-600">
              {rotas.reduce((sum, r) => sum + r.quantidadePedidos, 0)}
            </div>
            <div className="text-gray-600">Total de Pedidos</div>
          </div>
          <div className="text-center p-4 bg-purple-50 rounded-lg">
            <div className="text-2xl font-bold text-purple-600">
              {formatarMoeda(rotas.reduce((sum, r) => sum + r.dinheiroRecebido, 0))}
            </div>
            <div className="text-gray-600">Total Recebido</div>
          </div>
        </div>
      </div>
    </div>
  );

  // Renderizar se√ß√£o de motoboys
  const renderMotoboys = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-xl p-6 shadow-lg">
        <h2 className="text-2xl font-bold text-gray-800 mb-6">üë§ Cadastrar Novo Motoboy</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
            <input
              type="text"
              value={novoMotoboy.nome}
              onChange={(e) => setNovoMotoboy({...novoMotoboy, nome: e.target.value})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="Nome completo do motoboy"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Telefone/WhatsApp</label>
            <input
              type="tel"
              value={novoMotoboy.telefone}
              onChange={(e) => setNovoMotoboy({...novoMotoboy, telefone: e.target.value})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="(11) 99999-9999"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">CNH</label>
            <input
              type="text"
              value={novoMotoboy.cnh}
              onChange={(e) => setNovoMotoboy({...novoMotoboy, cnh: e.target.value})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="N√∫mero da CNH"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Ve√≠culo</label>
            <input
              type="text"
              value={novoMotoboy.veiculo}
              onChange={(e) => setNovoMotoboy({...novoMotoboy, veiculo: e.target.value})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="Marca/Modelo da moto"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Placa</label>
            <input
              type="text"
              value={novoMotoboy.placa}
              onChange={(e) => setNovoMotoboy({...novoMotoboy, placa: e.target.value})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="ABC-1234"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Data de Admiss√£o</label>
            <input
              type="date"
              value={novoMotoboy.dataAdmissao}
              onChange={(e) => setNovoMotoboy({...novoMotoboy, dataAdmissao: e.target.value})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
            />
          </div>
        </div>
        <button
          onClick={cadastrarMotoboy}
          className="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all duration-200 flex items-center"
        >
          <Plus className="mr-2" size={20} />
          Cadastrar Motoboy
        </button>
      </div>

      <div className="bg-white rounded-xl shadow-lg overflow-hidden">
        <div className="px-6 py-4 bg-gray-50 border-b">
          <h3 className="text-lg font-semibold text-gray-800">üë• Motoboys Cadastrados</h3>
        </div>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gradient-to-r from-gray-800 to-gray-700 text-white">
              <tr>
                <th className="px-4 py-3 text-left">Nome</th>
                <th className="px-4 py-3 text-left">Telefone</th>
                <th className="px-4 py-3 text-left">CNH</th>
                <th className="px-4 py-3 text-left">Ve√≠culo</th>
                <th className="px-4 py-3 text-left">Placa</th>
                <th className="px-4 py-3 text-left">Admiss√£o</th>
                <th className="px-4 py-3 text-left">Status</th>
                <th className="px-4 py-3 text-center">A√ß√µes</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {motoboys.map((motoboy) => (
                <tr key={motoboy.id} className="hover:bg-gray-50">
                  <td className="px-4 py-3 font-semibold">{motoboy.nome}</td>
                  <td className="px-4 py-3">{motoboy.telefone}</td>
                  <td className="px-4 py-3">{motoboy.cnh}</td>
                  <td className="px-4 py-3">{motoboy.veiculo}</td>
                  <td className="px-4 py-3">{motoboy.placa}</td>
                  <td className="px-4 py-3">{formatarData(motoboy.dataAdmissao)}</td>
                  <td className="px-4 py-3">
                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                      motoboy.status === 'ativo' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                    }`}>
                      {motoboy.status.toUpperCase()}
                    </span>
                  </td>
                  <td className="px-4 py-3 text-center">
                    <div className="flex justify-center space-x-2">
                      <button
                        onClick={() => removerMotoboy(motoboy.id)}
                        className="text-red-600 hover:text-red-800 p-1"
                      >
                        <Trash2 size={16} />
                      </button>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );

  // Renderizar se√ß√£o de rotas
  const renderRotas = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-xl p-6 shadow-lg">
        <h2 className="text-2xl font-bold text-gray-800 mb-6">üõ£Ô∏è Registrar Rota</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Motoboy</label>
            <select
              value={novaRota.motoboyId}
              onChange={(e) => setNovaRota({...novaRota, motoboyId: e.target.value})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
            >
              <option value="">Selecione o motoboy</option>
              {motoboys.filter(m => m.status === 'ativo').map(motoboy => (
                <option key={motoboy.id} value={motoboy.id}>{motoboy.nome}</option>
              ))}
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Data</label>
            <input
              type="date"
              value={novaRota.data}
              onChange={(e) => setNovaRota({...novaRota, data: e.target.value})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Qtd. Pedidos</label>
            <input
              type="number"
              value={novaRota.quantidadePedidos}
              onChange={(e) => setNovaRota({...novaRota, quantidadePedidos: parseInt(e.target.value) || 0})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="0"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Valor da Rota (R$)</label>
            <input
              type="number"
              step="0.01"
              value={novaRota.valorRota}
              onChange={(e) => setNovaRota({...novaRota, valorRota: parseFloat(e.target.value) || 0})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Dinheiro Recebido (R$)</label>
            <input
              type="number"
              step="0.01"
              value={novaRota.dinheiroRecebido}
              onChange={(e) => setNovaRota({...novaRota, dinheiroRecebido: parseFloat(e.target.value) || 0})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Trocos (R$)</label>
            <input
              type="number"
              step="0.01"
              value={novaRota.trocos}
              onChange={(e) => setNovaRota({...novaRota, trocos: parseFloat(e.target.value) || 0})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Descontos (R$)</label>
            <input
              type="number"
              step="0.01"
              value={novaRota.descontos}
              onChange={(e) => setNovaRota({...novaRota, descontos: parseFloat(e.target.value) || 0})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Adiantamentos (R$)</label>
            <input
              type="number"
              step="0.01"
              value={novaRota.adiantamentos}
              onChange={(e) => setNovaRota({...novaRota, adiantamentos: parseFloat(e.target.value) || 0})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Dinheiro Retido (R$)</label>
            <input
              type="number"
              step="0.01"
              value={novaRota.dinheiroRetido}
              onChange={(e) => setNovaRota({...novaRota, dinheiroRetido: parseFloat(e.target.value) || 0})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              placeholder="0.00"
              min="0"
            />
          </div>
          <div className="md:col-span-2 lg:col-span-3">
            <label className="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes</label>
            <textarea
              value={novaRota.observacoes}
              onChange={(e) => setNovaRota({...novaRota, observacoes: e.target.value})}
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
              rows="3"
              placeholder="Observa√ß√µes da rota"
            />
          </div>
        </div>
        
        <div className="flex flex-wrap gap-4 items-center">
          <button
            onClick={adicionarRota}
            className="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transition-all duration-200 flex items-center"
          >
            <Plus className="mr-2" size={20} />
            Registrar Rota
          </button>
          
          {novaRota.dinheiroRecebido > 0 && (
            <div className="bg-gray-100 px-4 py-3 rounded-lg font-semibold">
              <Calculator className="inline mr-2" size={16} />
              üí∞ Valor Final a Receber: {formatarMoeda(calcularValorFinalReceber())}
            </div>
          )}
        </div>
      </div>

      <div className="bg-white rounded-xl shadow-lg overflow-hidden">
        <div className="px-6 py-4 bg-gray-50 border-b">
          <h3 className="text-lg font-semibold text-gray-800">üõ£Ô∏è Rotas Registradas</h3>
        </div>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gradient-to-r from-gray-800 to-gray-700 text-white">
              <tr>
                <th className="px-3 py-3 text-left text-xs">Data</th>
                <th className="px-3 py-3 text-left text-xs">Motoboy</th>
                <th className="px-3 py-3 text-center text-xs">Pedidos</th>
                <th className="px-3 py-3 text-center text-xs">Valor Rota</th>
                <th className="px-3 py-3 text-center text-xs">Recebido</th>
                <th className="px-3 py-3 text-center text-xs">Trocos</th>
                <th className="px-3 py-3 text-center text-xs">Descontos</th>
                <th className="px-3 py-3 text-center text-xs">Adiantamentos</th>
                <th className="px-3 py-3 text-center text-xs">Retido</th>
                <th className="px-3 py-3 text-center text-xs">Valor Final</th>
                <th className="px-3 py-3 text-center text-xs">Status</th>
                <th className="px-3 py-3 text-center text-xs">A√ß√µes</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {rotas.slice().reverse().map((rota) => {
                const status = rota.prestouContas ? 'OK' : 'PENDENTE';
                const statusClass = rota.prestouContas ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
                
                return (
                  <tr key={rota.id} className="hover:bg-gray-50">
                    <td className="px-3 py-3 text-xs">{formatarData(rota.data)}</td>
                    <td className="px-3 py-3 text-xs font-semibold">{rota.motoboyNome}</td>
                    <td className="px-3 py-3 text-center text-xs">{rota.quantidadePedidos}</td>
                    <td className="px-3 py-3 text-center text-xs">{formatarMoeda(rota.valorRota)}</td>
                    <td className="px-3 py-3 text-center text-xs">{formatarMoeda(rota.dinheiroRecebido)}</td>
                    <td className="px-3 py-3 text-center text-xs">{formatarMoeda(rota.trocos)}</td>
                    <td className="px-3 py-3 text-center text-xs">{formatarMoeda(rota.descontos)}</td>
                    <td className="px-3 py-3 text-center text-xs">{formatarMoeda(rota.adiantamentos)}</td>
                    <td className="px-3 py-3 text-center text-xs">{formatarMoeda(rota.dinheiroRetido)}</td>
                    <td className="px-3 py-3 text-center text-xs font-bold">{formatarMoeda(rota.valorFinalReceber)}</td>
                    <td className="px-3 py-3 text-center">
                      <span className={`px-2 py-1 rounded-full text-xs font-medium ${statusClass}`}>
                        {status}
                      </span>
                    </td>
                    <td className="px-3 py-3 text-center">
                      <div className="flex justify-center space-x-1">
                        <button
                          onClick={() => marcarPrestacao(rota.id)}
                          disabled={rota.prestouContas}
                          className={`p-1 rounded ${rota.prestouContas ? 'text-gray-400' : 'text-green-600 hover:text-green-800'}`}
                        >
                          <CheckCircle size={16} />
                        </button>
                        <button
                          onClick={() => removerRota(rota.id)}
                          className="text-red-600 hover:text-red-800 p-1"
                        >
                          <Trash2 size={16} />
                        </button>
                      </div>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );

  // Renderizar cards di√°rios
  const renderCardsDiarios = () => {
    const rotasDoDia = rotas.filter(r => r.data === filtroData);
    const motoboysDoDia = [...new Set(rotasDoDia.map(r => r.motoboyId))];

    return (
      <div className="space-y-6">
        <div className="bg-white rounded-xl p-6 shadow-lg">
          <div className="flex flex-wrap gap-4 items-center justify-between">
            <div className="flex items-center gap-4">
              <Calendar className="text-red-500" size={24} />
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Filtrar por data:</label>
                <input
                  type="date"
                  value={filtroData}
                  onChange={(e) => setFiltroData(e.target.value)}
                  className="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                />
              </div>
            </div>
            <div className="flex gap-3">
              <button
                onClick={() => {
                  const dataFiltro = filtroData;
                  const rotasDoDia = rotas.filter(r => r.data === dataFiltro);
                  const motoboysDoDia = [...new Set(rotasDoDia.map(r => r.motoboyId))];
                  
                  let textoCompleto = `üìã *PRESTA√á√ÉO DE CONTAS DI√ÅRIA - ${formatarData(dataFiltro)}*\n`;
                  textoCompleto += `üè™ *Cal√ßados 24h*\n\n`;
                  
                  motoboysDoDia.forEach(motoboyId => {
                    const motoboy = motoboys.find(m => m.id === motoboyId);
                    const rotasMotoboy = rotasDoDia.filter(r => r.motoboyId === motoboyId);
                    
                    const totalPedidos = rotasMotoboy.reduce((sum, r) => sum + r.quantidadePedidos, 0);
                    const totalValorFinal = rotasMotoboy.reduce((sum, r) => sum + r.valorFinalReceber, 0);
                    
                    textoCompleto += `üë§ *${motoboy.nome}*\n`;
                    textoCompleto += `üõçÔ∏è Pedidos: ${totalPedidos}\n`;
                    textoCompleto += `üí∞ Valor Final a Receber: ${formatarMoeda(totalValorFinal)}\n\n`;
                  });
                  
                  navigator.clipboard.writeText(textoCompleto).then(() => {
                    alert('Resumo de todos os cards copiado!');
                  });
                }}
                className="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all duration-200 flex items-center"
              >
                <Copy className="mr-2" size={16} />
                Copiar Todos
              </button>
            </div>
          </div>
        </div>

        {motoboysDoDia.length === 0 ? (
          <div className="text-center py-12 bg-white rounded-xl shadow-lg">
            <Calendar className="mx-auto text-gray-400 mb-4" size={64} />
            <p className="text-gray-500 text-lg">Nenhuma rota encontrada para esta data.</p>
            <p className="text-gray-400">Selecione uma data diferente ou registre uma nova rota.</p>
          </div>
        ) : (
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {motoboysDoDia.map(motoboyId => {
              const motoboy = motoboys.find(m => m.id === motoboyId);
              const rotasMotoboy = rotasDoDia.filter(r => r.motoboyId === motoboyId);
              
              const totalPedidos = rotasMotoboy.reduce((sum, r) => sum + r.quantidadePedidos, 0);
              const totalValorRota = rotasMotoboy.reduce((sum, r) => sum + r.valorRota, 0);
              const totalRecebido = rotasMotoboy.reduce((sum, r) => sum + r.dinheiroRecebido, 0);
              const totalTrocos = rotasMotoboy.reduce((sum, r) => sum + r.trocos, 0);
              const totalDescontos = rotasMotoboy.reduce((sum, r) => sum + r.descontos, 0);
              const totalAdiantamentos = rotasMotoboy.reduce((sum, r) => sum + r.adiantamentos, 0);
              const totalRetido = rotasMotoboy.reduce((sum, r) => sum + r.dinheiroRetido, 0);
              const totalValorFinal = rotasMotoboy.reduce((sum, r) => sum + r.valorFinalReceber, 0);

              return (
                <div key={motoboyId} className="bg-white rounded-xl p-6 shadow-lg border-l-4 border-red-500">
                  <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center">
                      <User className="text-red-500 mr-3" size={24} />
                      <h3 className="text-xl font-bold text-gray-800">{motoboy.nome}</h3>
                    </div>
                    <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                      VALOR FINAL
                    </span>
                  </div>
                  
                  <div className="bg-gray-50 rounded-lg p-4 mb-6">
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div className="flex justify-between">
                        <span className="text-gray-600">üìä Pedidos:</span>
                        <span className="font-semibold">{totalPedidos}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">üí∞ Valor Rota:</span>
                        <span className="font-semibold">{formatarMoeda(totalValorRota)}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">üíµ Recebido:</span>
                        <span className="font-semibold">{formatarMoeda(totalRecebido)}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">üîÑ Trocos:</span>
                        <span className="font-semibold">{formatarMoeda(totalTrocos)}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">üí≥ Descontos:</span>
                        <span className="font-semibold">{formatarMoeda(totalDescontos)}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">‚è∞ Adiantamentos:</span>
                        <span className="font-semibold">{formatarMoeda(totalAdiantamentos)}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">üè™ Retido:</span>
                        <span className="font-semibold">{formatarMoeda(totalRetido)}</span>
                      </div>
                    </div>
                    
                    <div className="border-t mt-4 pt-4">
                      <div className="flex justify-between items-center">
                        <span className="font-bold text-gray-800">VALOR FINAL A RECEBER:</span>
                        <span className="text-2xl font-bold text-blue-600">
                          {formatarMoeda(totalValorFinal)}
                        </span>
                      </div>
                    </div>
                  </div>

                  <div className="bg-green-600 text-white p-4 rounded-lg mb-4 font-mono text-sm leading-relaxed">
                    üèçÔ∏è <strong>PRESTA√á√ÉO DE CONTAS DI√ÅRIA</strong><br />
                    üìÖ Data: {formatarData(filtroData)}<br />
                    üë§ Motoboy: <strong>{motoboy.nome}</strong><br />
                    üè™ Empresa: <strong>Cal√ßados 24h</strong><br /><br />
                    
                    üìä <strong>RESUMO DO DIA:</strong><br />
                    üõçÔ∏è Pedidos Entregues: {totalPedidos}<br />
                    üí∞ Valor da Rota: {formatarMoeda(totalValorRota)}<br />
                    üíµ Dinheiro Recebido: {formatarMoeda(totalRecebido)}<br /><br />
                    
                    üí∏ <strong>C√ÅLCULO:</strong><br />
                    ‚ûï Trocos: {formatarMoeda(totalTrocos)}<br />
                    ‚ûñ Descontos L√≠quido: {formatarMoeda(totalDescontos)}<br />
                    ‚ûñ Adiantamento L√≠quido: {formatarMoeda(totalAdiantamentos)}<br />
                    ‚ûï Retido: {formatarMoeda(totalRetido)}<br /><br />
                    
                    üí∞ <strong>VALOR FINAL A RECEBER: {formatarMoeda(totalValorFinal)}</strong><br /><br />
                    
                    <em>Sistema de Gest√£o - {new Date().toLocaleDateString('pt-BR')}</em>
                  </div>

                  <div className="flex gap-3">
                    <button
                      onClick={() => copiarCard(motoboyId, filtroData)}
                      className="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-2 px-4 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all duration-200 flex items-center justify-center"
                    >
                      <Copy className="mr-2" size={16} />
                      Copiar Card
                    </button>
                    <button
                      onClick={() => enviarWhatsApp(motoboy.telefone, motoboyId, filtroData)}
                      className="flex-1 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white py-2 px-4 rounded-lg font-semibold hover:from-yellow-600 hover:to-yellow-700 transition-all duration-200 flex items-center justify-center"
                    >
                      <Phone className="mr-2" size={16} />
                      WhatsApp
                    </button>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    );
  };

  // Renderizar relat√≥rios
  const renderRelatorios = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-xl p-6 shadow-lg">
        <h2 className="text-2xl font-bold text-gray-800 mb-6">üìä Relat√≥rios</h2>
        <div className="text-center py-12">
          <BarChart3 className="mx-auto text-gray-400 mb-4" size={64} />
          <p className="text-gray-500 text-lg">Se√ß√£o de Relat√≥rios</p>
          <p className="text-gray-400">Em desenvolvimento - Em breve relat√≥rios avan√ßados com gr√°ficos e exporta√ß√£o PDF.</p>
        </div>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-blue-800 p-4">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="bg-gradient-to-r from-gray-800 to-gray-700 text-white rounded-t-xl p-8 text-center relative overflow-hidden">
          <div className="absolute inset-0 bg-black opacity-10"></div>
          <div className="relative z-10">
            <div className="flex justify-center items-center gap-6 mb-6 flex-wrap">
              <div className="text-5xl font-bold">
                <span className="text-white drop-shadow-lg">Cal√ßados</span>{' '}
                <span className="text-red-400 drop-shadow-lg">24h</span>
              </div>
            </div>
            <h1 className="text-3xl font-bold mb-2 drop-shadow-md">üèçÔ∏è Sistema de Gest√£o de Motoboys</h1>
            <p className="text-lg opacity-90">Controle Completo com Dashboards e Relat√≥rios</p>
          </div>
        </div>

        {/* Navigation */}
        <div className="bg-gray-700 px-6 py-4 flex flex-wrap justify-center gap-4">
          {[
            { id: 'dashboard', label: 'üìä Dashboard', icon: BarChart3 },
            { id: 'motoboys', label: 'üë• Motoboys', icon: User },
            { id: 'rotas', label: 'üõ£Ô∏è Rotas', icon: Package },
            { id: 'daily-cards', label: 'üí¨ Cards Di√°rios', icon: MessageCircle },
            { id: 'reports', label: 'üìà Relat√≥rios', icon: FileText }
          ].map(tab => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`px-6 py-3 rounded-full font-medium transition-all duration-200 flex items-center gap-2 ${
                activeTab === tab.id
                  ? 'bg-white text-gray-800 shadow-lg transform -translate-y-1'
                  : 'bg-gray-600 text-white hover:bg-gray-500'
              }`}
            >
              <tab.icon size={18} />
              {tab.label}
            </button>
          ))}
        </div>

        {/* Content */}
        <div className="bg-gray-100 rounded-b-xl p-6">
          {activeTab === 'dashboard' && renderDashboard()}
          {activeTab === 'motoboys' && renderMotoboys()}
          {activeTab === 'rotas' && renderRotas()}
          {activeTab === 'daily-cards' && renderCardsDiarios()}
          {activeTab === 'reports' && renderRelatorios()}
        </div>
      </div>
    </div>
  );
};

export default MotoboyManagementSystem;
