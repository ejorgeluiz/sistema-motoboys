<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calçados 24h - Sistema de Prestação de Contas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab.active {
            color: #1f2937;
            background: white;
            border-bottom: 2px solid #3b82f6;
        }

        .tab:hover:not(.active) {
            background: #f3f4f6;
            color: #374151;
        }

        .tab-content {
            display: none;
            padding: 25px;
        }

        .tab-content.active {
            display: block;
        }

        /* Estilos da planilha */
        .spreadsheet-container {
            overflow-x: auto;
            margin-bottom: 20px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
        }

        .spreadsheet {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            min-width: 1200px;
        }

        .spreadsheet th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border: 1px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .spreadsheet td {
            padding: 8px;
            border: 1px solid #dee2e6;
            text-align: center;
        }

        .spreadsheet tr:nth-child(even) {
            background: #f8f9fa;
        }

        .spreadsheet tr:hover {
            background: #e3f2fd;
        }

        .spreadsheet input, .spreadsheet select {
            width: 100%;
            border: none;
            padding: 6px;
            font-size: 13px;
            text-align: center;
            background: transparent;
        }

        .spreadsheet input:focus, .spreadsheet select:focus {
            outline: 2px solid #3498db;
            background: white;
            border-radius: 4px;
        }

        .resultado {
            background: #e8f5e8 !important;
            font-weight: bold;
            color: #2e7d32;
        }

        .totals-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .total-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: #1f2937;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 1px solid #e5e7eb;
        }

        .total-card h3 {
            margin-bottom: 15px;
            font-size: 1.1em;
            text-align: center;
            color: #374151;
            font-weight: 600;
        }

        .total-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Cadastro de motoboys */
        .motoboy-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .motoboy-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .motoboy-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
            transition: background 0.2s ease;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .edit-btn {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s ease;
        }

        .edit-btn:hover {
            background: #2563eb;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        /* Checklist */
        .checklist-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .checklist-table th, .checklist-table td {
            padding: 12px;
            border: 1px solid #dee2e6;
            text-align: left;
        }

        .checklist-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .checklist-table tr:nth-child(even) {
            background: #f9fafb;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Modal para relatório */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .report-content {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .prestacao-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #3498db;
        }

        .prestacao-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prestacao-details {
            font-size: 13px;
            line-height: 1.6;
        }

        .prestacao-details .item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .prestacao-details .item.total {
            font-weight: bold;
            border-top: 1px solid #ecf0f1;
            margin-top: 10px;
            padding-top: 10px;
            color: #2c3e50;
        }

        .prestacao-details .rota-group {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .prestacao-details .rota-title {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .totals-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 Calçados 24h</h1>
            <p>Sistema de Prestação de Contas</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('planilha')">📋 Planilha</button>
            <button class="tab" onclick="showTab('motoboys')">🏍️ Motoboys</button>
            <button class="tab" onclick="showTab('checklist')">✅ Checklist Bling</button>
        </div>

        <!-- Aba Planilha -->
        <div id="planilha" class="tab-content active">
            <div class="controls">
                <button class="btn btn-primary" onclick="addRow()">➕ Adicionar Linha</button>
                <button class="btn btn-success" onclick="showReportOptions()">📊 Relatórios</button>
                <button class="btn btn-warning" onclick="exportToExcel()">📄 Exportar Excel</button>
                <button class="btn btn-primary" onclick="clearData()">🗑️ Limpar Dados</button>
            </div>

            <!-- Filtros de Relatório -->
            <div id="reportFilters" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3>📊 Opções de Relatório</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                    <div class="form-group">
                        <label>Motoboy:</label>
                        <select id="filterMotoboy">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Período:</label>
                        <select id="filterPeriodo" onchange="toggleDateInputs()">
                            <option value="hoje">Hoje</option>
                            <option value="ontem">Ontem</option>
                            <option value="semana">Esta Semana</option>
                            <option value="mes">Este Mês</option>
                            <option value="intervalo">Intervalo Personalizado</option>
                        </select>
                    </div>
                </div>
                <div id="dateInputs" style="display: none; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                    <div class="form-group">
                        <label>Data Inicial:</label>
                        <input type="date" id="dataInicial">
                    </div>
                    <div class="form-group">
                        <label>Data Final:</label>
                        <input type="date" id="dataFinal">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-success" onclick="generateFilteredReport()">Gerar Relatório</button>
                    <button class="btn btn-primary" onclick="generateCards()">Gerar Cards</button>
                    <button class="btn btn-secondary" onclick="generateWhatsAppCards()">📱 Cards WhatsApp</button>
                    <button class="btn" onclick="hideReportOptions()" style="background: #6c757d; color: white;">Cancelar</button>
                </div>
            </div>

            <div class="spreadsheet-container">
                <table class="spreadsheet" id="mainTable">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Motoboy</th>
                            <th>Rota</th>
                            <th>Status</th>
                            <th>Nº Pedido</th>
                            <th>Dinheiro Recebido</th>
                            <th>Valor da Rota</th>
                            <th>Desconto</th>
                            <th>Troco</th>
                            <th>Dinheiro Retido</th>
                            <th>Resultado</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>

            <div class="totals-section" id="totalsSection">
            </div>

            <!-- Cards de Prestação -->
            <div id="cardsSection" style="display: none;">
                <h3>📋 Cards de Prestação de Contas</h3>
                <div class="cards-container" id="cardsContainer">
                </div>
            </div>
        </div>

        <!-- Aba Motoboys -->
        <div id="motoboys" class="tab-content">
            <div class="motoboy-form">
                <h3>Cadastrar Novo Motoboy</h3>
                <div class="form-group">
                    <label for="newMotoboy">Nome do Motoboy:</label>
                    <input type="text" id="newMotoboy" placeholder="Digite o nome do motoboy">
                </div>
                <button class="btn btn-primary" onclick="addMotoboy()">Adicionar Motoboy</button>
            </div>

            <h3>Motoboys Cadastrados</h3>
            <div class="motoboy-list" id="motoboyList">
            </div>
        </div>

        <!-- Aba Checklist -->
        <div id="checklist" class="tab-content">
            <h3>Checklist Bling - Conferência de Pedidos</h3>
            <table class="checklist-table" id="checklistTable">
                <thead>
                    <tr>
                        <th>Nº Pedido</th>
                        <th>Conferido?</th>
                        <th>Formas de Pagamento</th>
                        <th>Valor Total</th>
                        <th>Data</th>
                        <th>Observações</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="checklistBody">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal para relatório -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>📊 Relatório por Rota</h2>
            <div class="report-content" id="reportContent"></div>
            <button class="btn btn-primary" onclick="copyReport()">📋 Copiar para WhatsApp</button>
        </div>
    </div>

    <script>
        // Dados globais
        let data = [];
        let motoboys = [];
        let checklist = [];
        const rotas = ['1', '2', '3', 'Única', 'Rota do dia'];
        const formasPagamento = ['Pix', 'Dinheiro', 'Cartão Débito', 'Cartão Crédito', 'Transferência', 'Outro'];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            loadStoredData();
            loadData();
            updateMotoboyList();
            updateChecklist();
            
            // Adicionar uma linha inicial se não houver dados
            if (data.length === 0) {
                addRow();
            }
        });

        // Carregar dados do armazenamento (usando variáveis JavaScript em vez de localStorage)
        function loadStoredData() {
            // Dados serão mantidos apenas durante a sessão
            if (typeof window.calcados24h_data === 'undefined') {
                data = [];
                motoboys = [];
                checklist = [];
            } else {
                data = window.calcados24h_data || [];
                motoboys = window.calcados24h_motoboys || [];
                checklist = window.calcados24h_checklist || [];
            }
        }

        // Função para mostrar abas
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Função para adicionar linha
        function addRow() {
            const newId = Date.now();
            const today = new Date().toLocaleDateString('pt-BR');
            const newRow = {
                id: newId,
                data: today,
                motoboy: '',
                rota: '',
                status: 'Pendente',
                pedido: '',
                dinheiroRecebido: 0,
                valorRota: 0,
                desconto: 0,
                troco: 0,
                dinheiroRetido: 0
            };
            
            data.push(newRow);
            saveData();
            loadData();
            
            // Focar no primeiro campo da nova linha
            setTimeout(() => {
                const lastRow = document.querySelector('#tableBody tr:last-child');
                if (lastRow) {
                    const firstInput = lastRow.querySelector('input[type="date"]');
                    if (firstInput) firstInput.focus();
                }
            }, 100);
        }

        // Função para carregar dados na tabela
        function loadData() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><input type="date" value="${row.data ? convertDateToInput(row.data) : ''}" onchange="updateData(${index}, 'data', new Date(this.value).toLocaleDateString('pt-BR'))" onkeydown="handleKeyNav(event, ${index}, 0)"></td>
                    <td>
                        <select onchange="updateData(${index}, 'motoboy', this.value)" onkeydown="handleKeyNav(event, ${index}, 1)">
                            <option value="">Selecione...</option>
                            ${motoboys.map(m => `<option value="${m}" ${row.motoboy === m ? 'selected' : ''}>${m}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <select onchange="updateData(${index}, 'rota', this.value)" onkeydown="handleKeyNav(event, ${index}, 2)">
                            <option value="">Selecione...</option>
                            ${rotas.map(r => `<option value="${r}" ${row.rota === r ? 'selected' : ''}>${r}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <select onchange="updateData(${index}, 'status', this.value)" onkeydown="handleKeyNav(event, ${index}, 3)">
                            <option value="OK" ${row.status === 'OK' ? 'selected' : ''}>OK</option>
                            <option value="Pendente" ${row.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                        </select>
                    </td>
                    <td><input type="text" value="${row.pedido || ''}" onchange="updateData(${index}, 'pedido', this.value)" onkeydown="handleKeyNav(event, ${index}, 4)"></td>
                    <td><input type="number" step="0.01" value="${row.dinheiroRecebido || 0}" onchange="updateData(${index}, 'dinheiroRecebido', parseFloat(this.value) || 0)" onkeydown="handleKeyNav(event, ${index}, 5)"></td>
                    <td><input type="number" step="0.01" value="${row.valorRota || 0}" onchange="updateData(${index}, 'valorRota', parseFloat(this.value) || 0)" onkeydown="handleKeyNav(event, ${index}, 6)"></td>
                    <td><input type="number" step="0.01" value="${row.desconto || 0}" onchange="updateData(${index}, 'desconto', parseFloat(this.value) || 0)" onkeydown="handleKeyNav(event, ${index}, 7)"></td>
                    <td><input type="number" step="0.01" value="${row.troco || 0}" onchange="updateData(${index}, 'troco', parseFloat(this.value) || 0)" onkeydown="handleKeyNav(event, ${index}, 8)"></td>
                    <td><input type="number" step="0.01" value="${row.dinheiroRetido || 0}" onchange="updateData(${index}, 'dinheiroRetido', parseFloat(this.value) || 0)" onkeydown="handleKeyNav(event, ${index}, 9)"></td>
                    <td class="resultado">R$ ${calculateResult(row).toFixed(2)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="edit-btn" onclick="editRow(${index})" title="Editar">✏️</button>
                            <button class="delete-btn" onclick="deleteRow(${index})" title="Excluir">🗑️</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            updateTotals();
        }

        // Converter data para formato de input
        function convertDateToInput(dateStr) {
            if (!dateStr) return '';
            const parts = dateStr.split('/');
            if (parts.length === 3) {
                return `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
            }
            return '';
        }

        // Navegação por teclado
        function handleKeyNav(event, rowIndex, colIndex) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const nextCol = colIndex + 1;
                const maxCols = 10; // número de colunas editáveis
                
                if (nextCol < maxCols) {
                    // Próxima coluna
                    const nextInput = document.querySelector(`#tableBody tr:nth-child(${rowIndex + 1}) td:nth-child(${nextCol + 1}) input, #tableBody tr:nth-child(${rowIndex + 1}) td:nth-child(${nextCol + 1}) select`);
                    if (nextInput) nextInput.focus();
                } else {
                    // Próxima linha, primeira coluna
                    const nextRowInput = document.querySelector(`#tableBody tr:nth-child(${rowIndex + 2}) td:first-child input`);
                    if (nextRowInput) {
                        nextRowInput.focus();
                    } else {
                        // Se não há próxima linha, criar uma nova
                        addRow();
                    }
                }
            }
        }

        // Função para calcular resultado
        function calculateResult(row) {
            const valorRota = parseFloat(row.valorRota) || 0;
            const desconto = parseFloat(row.desconto) || 0;
            const troco = parseFloat(row.troco) || 0;
            const dinheiroRetido = parseFloat(row.dinheiroRetido) || 0;
            
            return valorRota - desconto - troco - dinheiroRetido;
        }

        // Função para atualizar dados
        function updateData(index, field, value) {
            if (data[index]) {
                data[index][field] = value;
                saveData();
                loadData();
                updateChecklist();
            }
        }

        // Função para editar linha
        function editRow(index) {
            const row = data[index];
            const newData = prompt(`Editando dados do pedido ${row.pedido || 'sem número'}:\n\nDigite os novos valores separados por vírgula na ordem:\nData, Motoboy, Rota, Status, Pedido, Dinheiro Recebido, Valor Rota, Desconto, Troco, Dinheiro Retido`, 
                `${row.data || ''}, ${row.motoboy || ''}, ${row.rota || ''}, ${row.status || 'Pendente'}, ${row.pedido || ''}, ${row.dinheiroRecebido || 0}, ${row.valorRota || 0}, ${row.desconto || 0}, ${row.troco || 0}, ${row.dinheiroRetido || 0}`);
            
            if (newData !== null) {
                const values = newData.split(',').map(v => v.trim());
                if (values.length >= 10) {
                    data[index] = {
                        ...row,
                        data: values[0] || row.data,
                        motoboy: values[1] || row.motoboy,
                        rota: values[2] || row.rota,
                        status: values[3] || row.status,
                        pedido: values[4] || row.pedido,
                        dinheiroRecebido: parseFloat(values[5]) || 0,
                        valorRota: parseFloat(values[6]) || 0,
                        desconto: parseFloat(values[7]) || 0,
                        troco: parseFloat(values[8]) || 0,
                        dinheiroRetido: parseFloat(values[9]) || 0
                    };
                    saveData();
                    loadData();
                    updateChecklist();
                }
            }
        }

        function deleteRow(index) {
            if (confirm('Tem certeza que deseja excluir esta linha?')) {
                data.splice(index, 1);
                saveData();
                loadData();
                updateChecklist();
            }
        }

        // Função para atualizar totais
        function updateTotals() {
            const totalsSection = document.getElementById('totalsSection');
            
            // Totais por motoboy
            const motoboyTotals = {};
            data.forEach(row => {
                if (row.motoboy) {
                    if (!motoboyTotals[row.motoboy]) {
                        motoboyTotals[row.motoboy] = 0;
                    }
                    motoboyTotals[row.motoboy] += calculateResult(row);
                }
            });

            // Totais por rota
            const rotaTotals = {};
            data.forEach(row => {
                if (row.rota) {
                    if (!rotaTotals[row.rota]) {
                        rotaTotals[row.rota] = 0;
                    }
                    rotaTotals[row.rota] += calculateResult(row);
                }
            });

            // Total geral
            const totalGeral = data.reduce((sum, row) => sum + calculateResult(row), 0);

            totalsSection.innerHTML = `
                <div class="total-card">
                    <h3>💰 Totais por Motoboy</h3>
                    ${Object.entries(motoboyTotals).map(([motoboy, total]) => 
                        `<div class="total-item"><span>${motoboy}:</span><span>R$ ${total.toFixed(2)}</span></div>`
                    ).join('')}
                </div>
                <div class="total-card">
                    <h3>🛣️ Totais por Rota</h3>
                    ${Object.entries(rotaTotals).map(([rota, total]) => 
                        `<div class="total-item"><span>Rota ${rota}:</span><span>R$ ${total.toFixed(2)}</span></div>`
                    ).join('')}
                </div>
                <div class="total-card">
                    <h3>📊 Total Geral</h3>
                    <div class="total-item"><span><strong>TOTAL:</strong></span><span><strong>R$ ${totalGeral.toFixed(2)}</strong></span></div>
                </div>
            `;
        }

        // Função para adicionar motoboy
        function addMotoboy() {
            const input = document.getElementById('newMotoboy');
            const name = input.value.trim();
            
            if (name && !motoboys.includes(name)) {
                motoboys.push(name);
                saveMotoboys();
                updateMotoboyList();
                loadData(); // Recarregar para atualizar dropdowns
                input.value = '';
            } else if (motoboys.includes(name)) {
                alert('Este motoboy já está cadastrado!');
            }
        }

        // Função para atualizar lista de motoboys
        function updateMotoboyList() {
            const list = document.getElementById('motoboyList');
            list.innerHTML = motoboys.map((motoboy, index) => `
                <div class="motoboy-item">
                    <span>${motoboy}</span>
                    <button class="delete-btn" onclick="deleteMotoboy(${index})">🗑️</button>
                </div>
            `).join('');
        }

        // Função para deletar motoboy
        function deleteMotoboy(index) {
            if (confirm('Tem certeza que deseja excluir este motoboy?')) {
                motoboys.splice(index, 1);
                saveMotoboys();
                updateMotoboyList();
                loadData();
            }
        }

        // Função para atualizar checklist
        function updateChecklist() {
            const checklistBody = document.getElementById('checklistBody');
            
            // Adicionar pedidos que não estão no checklist
            data.forEach(row => {
                if (row.pedido && !checklist.find(c => c.pedido === row.pedido)) {
                    checklist.push({
                        pedido: row.pedido,
                        conferido: false,
                        formasPagamento: [],
                        valorTotal: parseFloat(row.valorRota) || 0,
                        data: new Date().toLocaleDateString('pt-BR'),
                        observacoes: ''
                    });
                }
            });

            // Remover pedidos que não existem mais
            checklist = checklist.filter(c => data.find(d => d.pedido === c.pedido));

            checklistBody.innerHTML = checklist.map((item, index) => `
                <tr>
                    <td>${item.pedido}</td>
                    <td><input type="checkbox" class="checkbox" ${item.conferido ? 'checked' : ''} onchange="updateChecklistItem(${index}, 'conferido', this.checked)"></td>
                    <td>
                        <div style="margin-bottom: 10px;">
                            <select onchange="addFormaPagamento(${index}, this.value); this.value='';">
                                <option value="">Adicionar forma...</option>
                                ${formasPagamento.map(fp => `<option value="${fp}">${fp}</option>`).join('')}
                            </select>
                        </div>
                        <div id="formasPag_${index}">
                            ${(item.formasPagamento || []).map((fp, fpIndex) => 
                                `<div style="display: flex; align-items: center; margin-bottom: 5px;">
                                    <span style="margin-right: 10px;">${fp.tipo}: R$ ${fp.valor.toFixed(2)}</span>
                                    <button class="delete-btn" onclick="removeFormaPagamento(${index}, ${fpIndex})">×</button>
                                </div>`
                            ).join('')}
                        </div>
                    </td>
                    <td>
                        <input type="number" step="0.01" value="${item.valorTotal || 0}" 
                               onchange="updateChecklistItem(${index}, 'valorTotal', parseFloat(this.value) || 0)"
                               style="width: 100px;">
                    </td>
                    <td><input type="date" value="${convertDateToInput(item.data)}" onchange="updateChecklistItem(${index}, 'data', new Date(this.value).toLocaleDateString('pt-BR'))"></td>
                    <td><input type="text" value="${item.observacoes || ''}" onchange="updateChecklistItem(${index}, 'observacoes', this.value)" style="min-width: 150px;"></td>
                    <td>
                        <div class="action-buttons">
                            <button class="edit-btn" onclick="editChecklistItem(${index})" title="Editar">✏️</button>
                            <button class="delete-btn" onclick="deleteChecklistItem(${index})" title="Excluir">🗑️</button>
                        </div>
                    </td>
                </tr>
            `).join('');

            saveChecklist();
        }

        // Função para adicionar forma de pagamento
        function addFormaPagamento(checklistIndex, tipo) {
            if (!tipo) return;
            
            const valor = prompt(`Digite o valor para ${tipo}:`, '0.00');
            if (valor !== null && !isNaN(parseFloat(valor))) {
                if (!checklist[checklistIndex].formasPagamento) {
                    checklist[checklistIndex].formasPagamento = [];
                }
                checklist[checklistIndex].formasPagamento.push({
                    tipo: tipo,
                    valor: parseFloat(valor)
                });
                saveChecklist();
                updateChecklist();
            }
        }

        // Função para remover forma de pagamento
        function removeFormaPagamento(checklistIndex, formaIndex) {
            checklist[checklistIndex].formasPagamento.splice(formaIndex, 1);
            saveChecklist();
            updateChecklist();
        }

        // Função para editar item do checklist
        function editChecklistItem(index) {
            const item = checklist[index];
            const formasText = (item.formasPagamento || []).map(fp => `${fp.tipo}: R$ ${fp.valor.toFixed(2)}`).join(', ');
            
            const newData = prompt(`Editando checklist do pedido ${item.pedido}:\n\nObservações atuais: ${item.observacoes || 'Nenhuma'}\nFormas de pagamento: ${formasText || 'Nenhuma'}\n\nDigite as novas observações:`, item.observacoes || '');
            
            if (newData !== null) {
                checklist[index].observacoes = newData;
                saveChecklist();
                updateChecklist();
            }
        }

        // Função para deletar item do checklist
        function deleteChecklistItem(index) {
            if (confirm('Tem certeza que deseja excluir este item do checklist?')) {
                checklist.splice(index, 1);
                saveChecklist();
                updateChecklist();
            }
        }

        // Função para atualizar item do checklist
        function updateChecklistItem(index, field, value) {
            if (checklist[index]) {
                checklist[index][field] = value;
                saveChecklist();
            }
        }

        // Funções de filtro de relatório
        function updateFilterOptions() {
            const filterMotoboy = document.getElementById('filterMotoboy');
            if (filterMotoboy) {
                filterMotoboy.innerHTML = '<option value="">Todos</option>';
                motoboys.forEach(motoboy => {
                    filterMotoboy.innerHTML += `<option value="${motoboy}">${motoboy}</option>`;
                });
            }
        }

        function showReportOptions() {
            document.getElementById('reportFilters').style.display = 'block';
            updateFilterOptions();
        }

        function hideReportOptions() {
            document.getElementById('reportFilters').style.display = 'none';
            document.getElementById('cardsSection').style.display = 'none';
        }

        function toggleDateInputs() {
            const periodo = document.getElementById('filterPeriodo').value;
            const dateInputs = document.getElementById('dateInputs');
            
            if (periodo === 'intervalo') {
                dateInputs.style.display = 'grid';
            } else {
                dateInputs.style.display = 'none';
            }
        }

        function getDateRange(periodo) {
            const hoje = new Date();
            const ontem = new Date(hoje);
            ontem.setDate(hoje.getDate() - 1);
            
            switch (periodo) {
                case 'hoje':
                    return {
                        inicio: hoje.toLocaleDateString('pt-BR'),
                        fim: hoje.toLocaleDateString('pt-BR')
                    };
                case 'ontem':
                    return {
                        inicio: ontem.toLocaleDateString('pt-BR'),
                        fim: ontem.toLocaleDateString('pt-BR')
                    };
                case 'semana':
                    const inicioSemana = new Date(hoje);
                    inicioSemana.setDate(hoje.getDate() - hoje.getDay());
                    return {
                        inicio: inicioSemana.toLocaleDateString('pt-BR'),
                        fim: hoje.toLocaleDateString('pt-BR')
                    };
                case 'mes':
                    const inicioMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                    return {
                        inicio: inicioMes.toLocaleDateString('pt-BR'),
                        fim: hoje.toLocaleDateString('pt-BR')
                    };
                case 'intervalo':
                    const dataInicial = document.getElementById('dataInicial').value;
                    const dataFinal = document.getElementById('dataFinal').value;
                    return {
                        inicio: dataInicial ? new Date(dataInicial).toLocaleDateString('pt-BR') : '',
                        fim: dataFinal ? new Date(dataFinal).toLocaleDateString('pt-BR') : ''
                    };
                default:
                    return { inicio: '', fim: '' };
            }
        }

        function filterData() {
            const motoboyFiltro = document.getElementById('filterMotoboy').value;
            const periodo = document.getElementById('filterPeriodo').value;
            const { inicio, fim } = getDateRange(periodo);
            
            return data.filter(row => {
                // Filtro por motoboy
                if (motoboyFiltro && row.motoboy !== motoboyFiltro) {
                    return false;
                }
                
                // Filtro por data
                if (inicio && fim) {
                    const dataRow = row.data;
                    if (!dataRow) return false;
                    
                    const [diaRow, mesRow, anoRow] = dataRow.split('/');
                    const [diaInicio, mesInicio, anoInicio] = inicio.split('/');
                    const [diaFim, mesFim, anoFim] = fim.split('/');
                    
                    const dataRowDate = new Date(anoRow, mesRow - 1, diaRow);
                    const dataInicioDate = new Date(anoInicio, mesInicio - 1, diaInicio);
                    const dataFimDate = new Date(anoFim, mesFim - 1, diaFim);
                    
                    return dataRowDate >= dataInicioDate && dataRowDate <= dataFimDate;
                }
                
                return true;
            });
        }

        function generateFilteredReport() {
            const filteredData = filterData();
            
            if (filteredData.length === 0) {
                alert('Nenhum dado encontrado para os filtros selecionados.');
                return;
            }
            
            const motoboyTotals = {};
            
            filteredData.forEach(row => {
                if (row.motoboy) {
                    if (!motoboyTotals[row.motoboy]) {
                        motoboyTotals[row.motoboy] = {
                            rotas: {},
                            total: 0,
                            pedidos: []
                        };
                    }
                    if (row.rota) {
                        if (!motoboyTotals[row.motoboy].rotas[row.rota]) {
                            motoboyTotals[row.motoboy].rotas[row.rota] = 0;
                        }
                        const resultado = calculateResult(row);
                        motoboyTotals[row.motoboy].rotas[row.rota] += resultado;
                        motoboyTotals[row.motoboy].total += resultado;
                        motoboyTotals[row.motoboy].pedidos.push(row);
                    }
                }
            });

            const totalGeral = filteredData.reduce((sum, row) => sum + calculateResult(row), 0);
            const periodo = document.getElementById('filterPeriodo').value;
            const { inicio, fim } = getDateRange(periodo);

            let report = `🚚 RELATÓRIO CALÇADOS 24H\n`;
            report += `📅 Período: ${inicio === fim ? inicio : `${inicio} a ${fim}`}\n`;
            report += `🏍️ Motoboy: ${document.getElementById('filterMotoboy').value || 'Todos'}\n\n`;

            Object.entries(motoboyTotals).forEach(([motoboy, dados]) => {
                report += `👤 ${motoboy.toUpperCase()}\n`;
                Object.entries(dados.rotas).forEach(([rota, valor]) => {
                    report += `   Rota ${rota}: R$ ${valor.toFixed(2)}\n`;
                });
                report += `   TOTAL: R$ ${dados.total.toFixed(2)}\n`;
                report += `   Pedidos: ${dados.pedidos.length}\n\n`;
            });

            report += `💰 TOTAL GERAL: R$ ${totalGeral.toFixed(2)}\n`;
            report += `📊 Total de pedidos: ${filteredData.length}`;

            document.getElementById('reportContent').textContent = report;
            document.getElementById('reportModal').style.display = 'block';
        }

        function generateCards() {
            const filteredData = filterData();
            
            if (filteredData.length === 0) {
                alert('Nenhum dado encontrado para os filtros selecionados.');
                return;
            }

            const motoboyTotals = {};
            
            filteredData.forEach(row => {
                if (row.motoboy) {
                    if (!motoboyTotals[row.motoboy]) {
                        motoboyTotals[row.motoboy] = {
                            rotas: {},
                            total: 0,
                            pedidos: [],
                            dinheiroRecebido: 0,
                            valorRota: 0,
                            desconto: 0,
                            troco: 0,
                            dinheiroRetido: 0
                        };
                    }
                    
                    const resultado = calculateResult(row);
                    motoboyTotals[row.motoboy].total += resultado;
                    motoboyTotals[row.motoboy].pedidos.push(row);
                    motoboyTotals[row.motoboy].dinheiroRecebido += parseFloat(row.dinheiroRecebido) || 0;
                    motoboyTotals[row.motoboy].valorRota += parseFloat(row.valorRota) || 0;
                    motoboyTotals[row.motoboy].desconto += parseFloat(row.desconto) || 0;
                    motoboyTotals[row.motoboy].troco += parseFloat(row.troco) || 0;
                    motoboyTotals[row.motoboy].dinheiroRetido += parseFloat(row.dinheiroRetido) || 0;
                    
                    if (row.rota) {
                        if (!motoboyTotals[row.motoboy].rotas[row.rota]) {
                            motoboyTotals[row.motoboy].rotas[row.rota] = {
                                valor: 0,
                                pedidos: []
                            };
                        }
                        motoboyTotals[row.motoboy].rotas[row.rota].valor += resultado;
                        motoboyTotals[row.motoboy].rotas[row.rota].pedidos.push(row);
                    }
                }
            });

            const periodo = document.getElementById('filterPeriodo').value;
            const { inicio, fim } = getDateRange(periodo);
            
            let cardsHtml = '';
            
            Object.entries(motoboyTotals).forEach(([motoboy, dados]) => {
                cardsHtml += `
                    <div class="prestacao-card">
                        <h4>
                            🏍️ ${motoboy}
                            <span style="font-size: 12px; color: #7f8c8d;">
                                ${inicio === fim ? inicio : `${inicio} a ${fim}`}
                            </span>
                        </h4>
                        <div class="prestacao-details">
                `;
                
                // Detalhes por rota
                Object.entries(dados.rotas).forEach(([rota, rotaData]) => {
                    cardsHtml += `
                        <div class="rota-group">
                            <div class="rota-title">📍 Rota ${rota} (${rotaData.pedidos.length} pedidos)</div>
                    `;
                    
                    rotaData.pedidos.forEach(pedido => {
                        cardsHtml += `
                            <div class="item">
                                <span>Pedido ${pedido.pedido}:</span>
                                <span>R$ ${calculateResult(pedido).toFixed(2)}</span>
                            </div>
                        `;
                    });
                    
                    cardsHtml += `
                            <div class="item total">
                                <span>Subtotal Rota ${rota}:</span>
                                <span>R$ ${rotaData.valor.toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                });
                
                // Resumo geral do motoboy
                cardsHtml += `
                    <div class="item">
                        <span>💰 Dinheiro Recebido:</span>
                        <span>R$ ${dados.dinheiroRecebido.toFixed(2)}</span>
                    </div>
                    <div class="item">
                        <span>🎯 Valor das Rotas:</span>
                        <span>R$ ${dados.valorRota.toFixed(2)}</span>
                    </div>
                    <div class="item">
                        <span>🏷️ Descontos:</span>
                        <span>R$ ${dados.desconto.toFixed(2)}</span>
                    </div>
                    <div class="item">
                        <span>💸 Trocos:</span>
                        <span>R$ ${dados.troco.toFixed(2)}</span>
                    </div>
                    <div class="item">
                        <span>🏦 Dinheiro Retido:</span>
                        <span>R$ ${dados.dinheiroRetido.toFixed(2)}</span>
                    </div>
                    <div class="item total">
                        <span>📊 TOTAL FINAL:</span>
                        <span>R$ ${dados.total.toFixed(2)}</span>
                    </div>
                    <div class="item">
                        <span>📋 Total de Pedidos:</span>
                        <span>${dados.pedidos.length}</span>
                    </div>
                </div>
                    </div>
                `;
            });
            
            document.getElementById('cardsContainer').innerHTML = cardsHtml;
            document.getElementById('cardsSection').style.display = 'block';
        }

        // Função para gerar cards individuais para WhatsApp
        function generateWhatsAppCards() {
            const filteredData = filterData();
            
            if (filteredData.length === 0) {
                alert('Nenhum dado encontrado para os filtros selecionados.');
                return;
            }

            const motoboyTotals = {};
            
            filteredData.forEach(row => {
                if (row.motoboy) {
                    if (!motoboyTotals[row.motoboy]) {
                        motoboyTotals[row.motoboy] = {
                            rotas: {},
                            total: 0,
                            pedidos: [],
                            dinheiroRecebido: 0,
                            valorRota: 0,
                            desconto: 0,
                            troco: 0,
                            dinheiroRetido: 0
                        };
                    }
                    
                    const resultado = calculateResult(row);
                    motoboyTotals[row.motoboy].total += resultado;
                    motoboyTotals[row.motoboy].pedidos.push(row);
                    motoboyTotals[row.motoboy].dinheiroRecebido += parseFloat(row.dinheiroRecebido) || 0;
                    motoboyTotals[row.motoboy].valorRota += parseFloat(row.valorRota) || 0;
                    motoboyTotals[row.motoboy].desconto += parseFloat(row.desconto) || 0;
                    motoboyTotals[row.motoboy].troco += parseFloat(row.troco) || 0;
                    motoboyTotals[row.motoboy].dinheiroRetido += parseFloat(row.dinheiroRetido) || 0;
                    
                    if (row.rota) {
                        if (!motoboyTotals[row.motoboy].rotas[row.rota]) {
                            motoboyTotals[row.motoboy].rotas[row.rota] = {
                                valor: 0,
                                pedidos: []
                            };
                        }
                        motoboyTotals[row.motoboy].rotas[row.rota].valor += resultado;
                        motoboyTotals[row.motoboy].rotas[row.rota].pedidos.push(row);
                    }
                }
            });

            const periodo = document.getElementById('filterPeriodo').value;
            const { inicio, fim } = getDateRange(periodo);
            
            // Gerar mensagens individuais para cada motoboy
            Object.entries(motoboyTotals).forEach(([motoboy, dados]) => {
                let message = `🚚 *CALÇADOS 24H*\n`;
                message += `📅 ${inicio === fim ? inicio : `${inicio} a ${fim}`}\n`;
                message += `🏍️ *${motoboy.toUpperCase()}*\n\n`;

                // Detalhes por rota
                Object.entries(dados.rotas).forEach(([rota, rotaData]) => {
                    message += `📍 *Rota ${rota}* (${rotaData.pedidos.length} pedidos)\n`;
                    
                    rotaData.pedidos.forEach(pedido => {
                        message += `   • Pedido ${pedido.pedido}: R$ ${calculateResult(pedido).toFixed(2)}\n`;
                    });
                    
                    message += `   💰 Subtotal: R$ ${rotaData.valor.toFixed(2)}\n\n`;
                });
                
                // Resumo
                message += `📊 *RESUMO FINANCEIRO*\n`;
                message += `💰 Dinheiro Recebido: R$ ${dados.dinheiroRecebido.toFixed(2)}\n`;
                message += `🎯 Valor das Rotas: R$ ${dados.valorRota.toFixed(2)}\n`;
                message += `🏷️ Descontos: R$ ${dados.desconto.toFixed(2)}\n`;
                message += `💸 Trocos: R$ ${dados.troco.toFixed(2)}\n`;
                message += `🏦 Dinheiro Retido: R$ ${dados.dinheiroRetido.toFixed(2)}\n\n`;
                message += `🔥 *TOTAL FINAL: R$ ${dados.total.toFixed(2)}*\n`;
                message += `📋 Total de Pedidos: ${dados.pedidos.length}`;

                // Copiar para clipboard automaticamente e mostrar modal
                navigator.clipboard.writeText(message).then(() => {
                    document.getElementById('reportContent').textContent = message;
                    document.getElementById('reportModal').style.display = 'block';
                    alert(`Relatório do ${motoboy} copiado para área de transferência!`);
                });
            });
        }

        function copyReport() {
            const reportContent = document.getElementById('reportContent').textContent;
            navigator.clipboard.writeText(reportContent).then(() => {
                alert('Relatório copiado para a área de transferência!');
            });
        }

        // Função para fechar modal
        function closeModal() {
            document.getElementById('reportModal').style.display = 'none';
        }

        // Função para exportar para Excel
        function exportToExcel() {
            const headers = ['Data', 'Motoboy', 'Rota', 'Status', 'Nº Pedido', 'Dinheiro Recebido', 'Valor da Rota', 'Desconto', 'Troco', 'Dinheiro Retido', 'Resultado'];
            
            let csvContent = headers.join(',') + '\n';
            
            data.forEach(row => {
                const line = [
                    row.data || '',
                    row.motoboy || '',
                    row.rota || '',
                    row.status || '',
                    row.pedido || '',
                    row.dinheiroRecebido || 0,
                    row.valorRota || 0,
                    row.desconto || 0,
                    row.troco || 0,
                    row.dinheiroRetido || 0,
                    calculateResult(row).toFixed(2)
                ];
                csvContent += line.join(',') + '\n';
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `calcados24h_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Função para limpar dados
        function clearData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Esta ação não pode ser desfeita.')) {
                data = [];
                checklist = [];
                saveData();
                saveChecklist();
                loadData();
                updateChecklist();
            }
        }

        // Funções de salvamento (usando variáveis JavaScript em vez de localStorage)
        function saveData() {
            window.calcados24h_data = data;
        }

        function saveMotoboys() {
            window.calcados24h_motoboys = motoboys;
        }

        function saveChecklist() {
            window.calcados24h_checklist = checklist;
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('reportModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Atalhos de teclado
        document.addEventListener('keydown', function(event) {
            // Ctrl + N para nova linha
            if (event.ctrlKey && event.key === 'n') {
                event.preventDefault();
                addRow();
            }
            
            // Ctrl + R para gerar relatório
            if (event.ctrlKey && event.key === 'r') {
                event.preventDefault();
                showReportOptions();
            }
            
            // Ctrl + E para exportar
            if (event.ctrlKey && event.key === 'e') {
                event.preventDefault();
                exportToExcel();
            }
            
            // ESC para fechar modal
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // Permitir Enter no campo de novo motoboy
        document.getElementById('newMotoboy').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                addMotoboy();
            }
        });
    </script>
</body>
          <script>
    const acesso = localStorage.getItem("autenticado");
    if (acesso !== "sim") {
      const senha = prompt("Digite a senha para acessar:");
      if (senha === "Admin.0258") {
        localStorage.setItem("autenticado", "sim");
      } else {
        alert("Senha incorreta. Redirecionando...");
        window.location.href = "about:blank";
      }
    }
  </script>

  <h1>Bem-vindo!</h1>
  <p>Esse conteúdo só aparece após digitar a senha.</p>

  <button onclick="logout()">Sair</button>
  <script>
    function logout() {
      localStorage.removeItem("autenticado");
      location.reload();
    }

    function formatarData(data) {
      return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
    }
  </script>
</body>
</html>
